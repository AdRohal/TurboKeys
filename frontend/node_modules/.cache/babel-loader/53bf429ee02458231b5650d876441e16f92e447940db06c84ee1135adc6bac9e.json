{"ast":null,"code":"import React,{createContext,useContext,useReducer,useEffect}from'react';import{authAPI}from'../services/api';import{jsx as _jsx}from\"react/jsx-runtime\";const initialState={user:null,token:localStorage.getItem('token'),loading:false,error:null};const authReducer=(state,action)=>{switch(action.type){case'AUTH_START':return{...state,loading:true,error:null};case'AUTH_SUCCESS':return{...state,loading:false,user:action.payload,token:action.payload.token,error:null};case'AUTH_FAILURE':return{...state,loading:false,error:action.payload,user:null,token:null};case'LOGOUT':return{...state,user:null,token:null,error:null};case'CLEAR_ERROR':return{...state,error:null};default:return state;}};const AuthContext=/*#__PURE__*/createContext(undefined);export const AuthProvider=_ref=>{let{children}=_ref;const[state,dispatch]=useReducer(authReducer,initialState);useEffect(()=>{const initializeAuth=async()=>{const token=localStorage.getItem('token');if(token){try{dispatch({type:'AUTH_START'});const user=await authAPI.getCurrentUser();dispatch({type:'AUTH_SUCCESS',payload:{...user,token}});}catch(error){localStorage.removeItem('token');dispatch({type:'AUTH_FAILURE',payload:'Session expired'});}}};initializeAuth();},[]);const login=async credentials=>{try{dispatch({type:'AUTH_START'});const response=await authAPI.login(credentials);localStorage.setItem('token',response.token);dispatch({type:'AUTH_SUCCESS',payload:response});}catch(error){dispatch({type:'AUTH_FAILURE',payload:error.message||'Login failed'});throw error;}};const register=async userData=>{try{dispatch({type:'AUTH_START'});const response=await authAPI.register(userData);localStorage.setItem('token',response.token);dispatch({type:'AUTH_SUCCESS',payload:response});}catch(error){dispatch({type:'AUTH_FAILURE',payload:error.message||'Registration failed'});throw error;}};const logout=()=>{localStorage.removeItem('token');dispatch({type:'LOGOUT'});};const clearError=()=>{dispatch({type:'CLEAR_ERROR'});};const value={...state,login,register,logout,clearError};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:children});};export const useAuth=()=>{const context=useContext(AuthContext);if(context===undefined){throw new Error('useAuth must be used within an AuthProvider');}return context;};","map":{"version":3,"names":["React","createContext","useContext","useReducer","useEffect","authAPI","jsx","_jsx","initialState","user","token","localStorage","getItem","loading","error","authReducer","state","action","type","payload","AuthContext","undefined","AuthProvider","_ref","children","dispatch","initializeAuth","getCurrentUser","removeItem","login","credentials","response","setItem","message","register","userData","logout","clearError","value","Provider","useAuth","context","Error"],"sources":["C:/GitHub/TurboKeys/frontend/src/contexts/AuthContext.tsx"],"sourcesContent":["import React, { createContext, useContext, useReducer, useEffect, ReactNode } from 'react';\r\nimport { User, AuthUser, LoginRequest, RegisterRequest } from '../types';\r\nimport { authAPI } from '../services/api';\r\n\r\ninterface AuthState {\r\n  user: User | null;\r\n  token: string | null;\r\n  loading: boolean;\r\n  error: string | null;\r\n}\r\n\r\ntype AuthAction =\r\n  | { type: 'AUTH_START' }\r\n  | { type: 'AUTH_SUCCESS'; payload: AuthUser }\r\n  | { type: 'AUTH_FAILURE'; payload: string }\r\n  | { type: 'LOGOUT' }\r\n  | { type: 'CLEAR_ERROR' };\r\n\r\nconst initialState: AuthState = {\r\n  user: null,\r\n  token: localStorage.getItem('token'),\r\n  loading: false,\r\n  error: null,\r\n};\r\n\r\nconst authReducer = (state: AuthState, action: AuthAction): AuthState => {\r\n  switch (action.type) {\r\n    case 'AUTH_START':\r\n      return {\r\n        ...state,\r\n        loading: true,\r\n        error: null,\r\n      };\r\n    case 'AUTH_SUCCESS':\r\n      return {\r\n        ...state,\r\n        loading: false,\r\n        user: action.payload,\r\n        token: action.payload.token,\r\n        error: null,\r\n      };\r\n    case 'AUTH_FAILURE':\r\n      return {\r\n        ...state,\r\n        loading: false,\r\n        error: action.payload,\r\n        user: null,\r\n        token: null,\r\n      };\r\n    case 'LOGOUT':\r\n      return {\r\n        ...state,\r\n        user: null,\r\n        token: null,\r\n        error: null,\r\n      };\r\n    case 'CLEAR_ERROR':\r\n      return {\r\n        ...state,\r\n        error: null,\r\n      };\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n\r\ninterface AuthContextType extends AuthState {\r\n  login: (credentials: LoginRequest) => Promise<void>;\r\n  register: (userData: RegisterRequest) => Promise<void>;\r\n  logout: () => void;\r\n  clearError: () => void;\r\n}\r\n\r\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\r\n\r\ninterface AuthProviderProps {\r\n  children: ReactNode;\r\n}\r\n\r\nexport const AuthProvider: React.FC<AuthProviderProps> = ({ children }) => {\r\n  const [state, dispatch] = useReducer(authReducer, initialState);\r\n\r\n  useEffect(() => {\r\n    const initializeAuth = async () => {\r\n      const token = localStorage.getItem('token');\r\n      if (token) {\r\n        try {\r\n          dispatch({ type: 'AUTH_START' });\r\n          const user = await authAPI.getCurrentUser();\r\n          dispatch({ type: 'AUTH_SUCCESS', payload: { ...user, token } });\r\n        } catch (error) {\r\n          localStorage.removeItem('token');\r\n          dispatch({ type: 'AUTH_FAILURE', payload: 'Session expired' });\r\n        }\r\n      }\r\n    };\r\n\r\n    initializeAuth();\r\n  }, []);\r\n\r\n  const login = async (credentials: LoginRequest) => {\r\n    try {\r\n      dispatch({ type: 'AUTH_START' });\r\n      const response = await authAPI.login(credentials);\r\n      localStorage.setItem('token', response.token);\r\n      dispatch({ type: 'AUTH_SUCCESS', payload: response });\r\n    } catch (error: any) {\r\n      dispatch({ type: 'AUTH_FAILURE', payload: error.message || 'Login failed' });\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  const register = async (userData: RegisterRequest) => {\r\n    try {\r\n      dispatch({ type: 'AUTH_START' });\r\n      const response = await authAPI.register(userData);\r\n      localStorage.setItem('token', response.token);\r\n      dispatch({ type: 'AUTH_SUCCESS', payload: response });\r\n    } catch (error: any) {\r\n      dispatch({ type: 'AUTH_FAILURE', payload: error.message || 'Registration failed' });\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  const logout = () => {\r\n    localStorage.removeItem('token');\r\n    dispatch({ type: 'LOGOUT' });\r\n  };\r\n\r\n  const clearError = () => {\r\n    dispatch({ type: 'CLEAR_ERROR' });\r\n  };\r\n\r\n  const value: AuthContextType = {\r\n    ...state,\r\n    login,\r\n    register,\r\n    logout,\r\n    clearError,\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={value}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n\r\nexport const useAuth = () => {\r\n  const context = useContext(AuthContext);\r\n  if (context === undefined) {\r\n    throw new Error('useAuth must be used within an AuthProvider');\r\n  }\r\n  return context;\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}